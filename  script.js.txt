// Waitlist Signup Handler
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("waitlistForm");
  const confirmation = document.getElementById("confirmation");
  const signupCount = document.getElementById("signup-count");

  // Google Sheets Script URL
  const scriptURL = "https://script.google.com/macros/s/AKfycbzw-tp0zDAf0WV2kCkIVADvMfX0Uz7mzPd_Zls9bO2ZXohX_yBeiuG7yr-LYcIbz1vF/exec";

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    const emailInput = document.getElementById("email");
    const email = emailInput.value.trim();

    if (email === "") {
      confirmation.style.color = "red";
      confirmation.textContent = "Please enter a valid email.";
      return;
    }

    fetch(scriptURL, {
      method: "POST",
      body: new URLSearchParams({ email: email })
    })
      .then(response => {
        confirmation.style.color = "green";
        confirmation.textContent = "Welcome to the future of aviation!";
        emailInput.value = "";
        updateSignupCount();
      })
      .catch(error => {
        confirmation.style.color = "red";
        confirmation.textContent = "Oops! Something went wrong. Please try again.";
        console.error("Error!", error.message);
      });
  });

  function updateSignupCount() {
    fetch("https://opensheet.elk.sh/11_JwMlY2YVNyVrzA64ljnCEn_qyuIKfHgXUGSvuVBqI/WaitlistSignups")
      .then(response => response.json())
      .then(data => {
        if (Array.isArray(data)) {
          signupCount.textContent = `Pilots Signed Up: ${data.length}`;
        } else {
          signupCount.textContent = "Pilots Signed Up: loading...";
        }
      })
      .catch(err => {
        signupCount.textContent = "Pilots Signed Up: Error";
        console.error("Failed to fetch signup count:", err);
      });
  }

  updateSignupCount();
});